# 电磁场驱动微型机器人的自动化操控研究

​																		   2021.9.23 - 2021.9.24

## A. 绪论

1. 施加旋转磁场驱动球形和螺旋形机器人比靠磁场梯度驱动的方式推进效率更高?

   同实验室[另一篇论文](file:\\D:\坚果云\我的坚果云\SJTU\磁控螺旋形微纳米机器人\徐天添团队\磁控软体微型机器人的优化设计与控制_苏梦（硕）√.caj)写的是：*螺旋微型机器人一般是用旋转磁场驱动，旋转磁场可以由均匀磁场
   或者梯度磁场产生，由均匀磁场产生的旋转磁场驱动螺旋微型机器人更稳定，但
   是由梯度磁场产生的旋转力更大，更易控制一些磁性较弱的螺旋微型机器人*

<div>			<!--块级封装-->
    <center>	<!--将图片和文字居中-->
    <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210923092537479.png"
         alt="图片源文件丢失：image-20210923092537479.png"
         style="zoom:这里写图片的缩放百分比"/>
    <br>		<!--换行-->
    Figure 1.3 Three kinds of Propulsion mechanisms<!--标题-->
    </center>
</div>

## B. 基于天然植物纤维的磁驱微型机器人运动学特性研究

1. Purcell指出在低雷诺数环境下的运动都是线性的

## C. 微型机器人的自动化操控研究

<div>
    <center>
        <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210923173027238.png"
             alt="图片源文件丢失：image-20210923173027238.png"
         	 style="zoom:这里写图片的缩放百分比"/>
    <br>		<!--换行-->
    Figure 3.2 Helmholtz coil system<!--标题-->
    </center>
</div>

### 运动规划：

**`首先由地图生成器处理捕获的图像，标记自由空间和障碍物空间->之后由路径规划器探索无障碍空间，以便从全局范围内找到从起点到目标位置的可行路径->最后通过运动控制器安路径方向引导机器人运动`**

<div>
    <center>
        <img src = "C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210923173834938.png"
             alt=""图片源文件丢失：image-20210923173834938.png""
             style= "zoom:这里写图片的缩放百分比"
         />
        <br>
        Figure 3.3 Automated manioulation framework
</div>

#### 路径规划算法

1. 对于磁场驱动机器人有两种常见的方法：**基于离散化的规划算法（如A\*和D\*）**、**基于采样的规划算法**（RRT）。
   - 基于离散化的运动规划算法需要离散化全局地图才能找到搜素代价最小的路径，这种离散化的操作可能使得A\*和D\*不能在狭小的缝隙中找到最短的路径。
   - 而RRT和RRT\*能克服这样的缺点。

- **但是网络上的观点是RRT算法，不管什么机器人类型、不管自由度是多少、不管约束有多复杂都能用。而且它的原理很简单，这是它在机器人领域流行的主要原因之一。不过它的缺点也很明显，它得到的路径一般质量都不是很好，例如可能包含棱角，不够光滑，通常也远离最优路径，同时难以在有狭窄通道的环境找到路径。因为狭窄通道面积小，被碰到的概率低，找到路径需要的时间要看运气了。**

  *路径规划的问题等先把基础控制做完再说，现在知道路径规划是有用的*

#### 运动控制器

1. 与[路径跟随](file:\\D:\坚果云\我的坚果云\SJTU\磁控螺旋形微纳米机器人\徐天添团队\磁控软体微型机器人的路径跟随控制研究_黄晨阳（硕）√.caj)这篇文章思路一样，将路径分段，完成每一小段的跟随任务，且由于机器人的重力和自身动力学模型的不确定性，内环使用PI控制器。

2. 与[路径跟随](file:\\D:\坚果云\我的坚果云\SJTU\磁控螺旋形微纳米机器人\徐天添团队\磁控软体微型机器人的路径跟随控制研究_黄晨阳（硕）√.caj)这篇文章不同的是外环不是通过调节参数 $M$ 来改变权重，而是将误差定义为
   $$
   E(k)=\frac{\delta^d_k}{\delta^d_k + \delta^{\theta}_k}\delta^d_k+\frac{\delta^{\theta}_k}{\delta^d_k + \delta^{\theta}_k}\delta^{\theta}_k
   $$

    <div>
        <center>
            <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210923200728914.png"
                 alt=""图片源文件丢失：image-20210923200728914.png""
                 style= "zoom:这里写图片的缩放百分比"
                 />
            <br>
            Figure 3.8 Control block diagram of path following
    </div>

3. 这篇文章的控制方案好像并不合理：

   - 1.  $e(t)$ 的两个分量分别是角度误差和距离误差，将角度误差和距离误差作为标量进行求和得到的 $E(k)$ 没有意义（这个从机器人重心到规定路径投影点的距离误差也没有意义，正常情况下这个误差应该调整运动的俯仰角，我默认这两个误差都是角度误差，这两个角度误差也是两个方向的，虽然可能耦合起来会存在干扰，但是也仍然没有意义，下面两个问题也相同）。
     2. 如果是作为向量进行相加，PI控制器是单输入单输出，无法控制矢量。
     3.  如果是使用两个PI控制器，那就无需计算权重，直接角度控制角度，距离控制速度即可。

   - 被控对象应该分为三个部分：1、磁场旋转中心轴的俯仰角；2、磁场旋转中心偏航角；**由于轨迹已知，所以磁场的角度可以对应到轨迹方向的垂直和平行方向上**；3、磁通量或者旋转频率（用来控制前进速度，这个量应该也可以不做控制）

4. 综合两篇文章进行修改，我认为比较合理的控制方案如下：

   1. 分别计算当前位置与路径上的投影点误差，该误差包含两部分：1、垂直于轨迹方向的距离误差；2、平行于轨迹方向的距离误差。

   2. 定义期望运动方向：与*路径跟随控制研究* 相同，采用距离加调参来控制权重来调节运动方向（这里必须用参数来手动调节（或者可以和路径有关，比如路径要发生改变就增加 $M$ ），因为沿着路径并没有误差这种可以用来控制的量）。
      $$
      	n^*=\frac{||d||}{||d||+M}d_⊥+\frac{M}{||d||+M}d_∥
      $$
       ( $d_⊥$ 和 $d_∥$ 分别是垂直和平行于路径的单位向量）

   3. 将期望运动方向变换成俯仰角和偏航角 $\theta_{pitch}$ 和 $\theta_{yaw}$。	

   4. 计算通过摄像头得到的机器人当前运动方向 $n$， 并将 $n$ 变换成角度 $\theta_{pitch}'$ 和 $\theta_{yaw}'$

   5. 分别计算误差 $e_{pitch} = \theta_{pitch} - \theta_{pitch}'$ 和 $e_{yaw} = \theta_{yaw} - \theta_{yaw}'$ 。

   6. 分别使用两个误差进行俯仰和偏航的两个PI，再分别进行映射到磁场中（文章中使用单层前馈神经网络ELM来拟合这个映射关系）。

      <div>
           <center>
               <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210923222813045.png"
                    alt=""图片源文件丢失：image-20210923222813045.png""
                    style= "zoom:这里写图片的缩放百分比"
                    />
               <br>
               Control block diagram of path following
       </div>

5. 文章只固定了俯仰角进行了二维空间上的路径跟随控制。

6. 可以将最后输出的磁场分解成垂直于旋转中轴方向（推进方向）和平行于旋转中轴方向的两个磁场，第一个磁场负责使机器人继续保持自转，第二个磁场负责控制机器人进行转向。

## D. 稳定高效的磁场驱动微型机器人的自动化操控研究

### Informed RRT*

​	在RRT*算法中获取到可行路径后，将采样空间收缩到椭圆形区域中，该算法效率高且几乎不影响路径效果。

### 神经网络映射

- 根据文章中的解释磁场的旋转方向和机器人的旋转方向相同，在没有扰动的情况下，机器人应该是沿着旋转中轴来进行运动的，但是由于**重力与浮力不平衡引起垂直方向干扰**、**边界效应引起侧向干扰**、**3D亥姆霍兹线圈系统产生的旋转磁场不是绝对均匀的**和**未建模的接触力的干扰**，机器人的实际运动方向与旋转中轴的方向不同。根据[路径跟随](file://D:\坚果云\我的坚果云\SJTU\磁控螺旋形微纳米机器人\磁控软体微型机器人的路径跟随控制研究_黄晨阳.caj)这篇文章发现方向改变还是比较大的：

  <div>
       <center>
           <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210924143223725.png"
                alt=""图片源文件丢失：image-20210924143223725.png""
                style= "zoom:50"
                />
           <br>
      微型机器人螺旋前进的方向转向角与外界磁场旋转轴方向角之间的映射关系 
   </div>

  <div>
       <center>
           <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210924143555781.png"
                alt=""图片源文件丢失：image-20210924143555781.png""
                style= "zoom:0"
                />
           <br>
      		实验得到的映射关系 
   </div>

- 文章中使用过的网络有：ELM、【误差反向传播算法训练】RBF-BP、OS-ELM

### 视觉反馈控制

1. 对于上一节的控制方案修改了两个部分：1、路径规划部分使用Informed RRT*算法；2、对于角度的控制使用了**基于iPID的滑模控制**； 3、使用神经元模型对误差进行过滤，以此来削弱反馈误差信号，使控制器的控制命令平滑有界。`两篇iPID论文要看一下、再看一下滑模和iPID融合的部分`

   <div>
        <center>
            <img src="C:\Users\33931\AppData\Roaming\Typora\typora-user-images\image-20210924144336802.png"
                 alt=""图片源文件丢失：image-20210924144336802.png""
                 style= "zoom:0"
                 />
            <br>
       		平面轨迹跟随控制框图 
    </div>

2. 如果神经网络的部分只是映射一个干扰补偿的话这个图后半部分没问题，不过应该可以去映射一个考虑了干扰的整体运动方向，然后对外环的输出进行整体的映射。

---

学习路径

1. 使用设备让机器人动起来
2. 使用PID完成平面闭环（机器学习角度映射？）x
3. 张正友相机标定求三维坐标
4. 使用PID完成三维闭环
5. 双闭环路径跟随
6. 加入路径规划
7. 修改内环控制方案（iPID/[PSMC](https://home.hiroshima-u.ac.jp/kikuuwe/res_psmc/index.html)/滑模/模糊）